# Story 1.4: Implement Core BOB Model Interface

## Status
Ready for Review

## Story
**As a** CMT member,
**I want** to add and link entries for Situation Assessment, Judgments, and Decisions,
**so that** we can track our decision-making process in a structured way.

## Acceptance Criteria
1. A dedicated page for the BOB model is created with three distinct columns.
2. Users can add a new text-based entry to any of the three columns.
3. Users can select an entry and link it to an existing entry in an adjacent column.
4. All BOB model data is persisted to the database.
5. Creating a new BOB entry generates a new event in the Activity Log on the dashboard.

## Tasks / Subtasks
- [x] Create BOB model page structure (AC: 1)
  - [x] Set up Next.js page route for /bob
  - [x] Create three-column layout using Tailwind CSS
  - [x] Add column headers: "Situation Assessment", "Judgments", "Decisions"
  - [x] Ensure responsive design for desktop and tablet
- [x] Implement entry creation functionality (AC: 2)
  - [x] Add "Add Entry" button to each column
  - [x] Create modal/form for text entry input
  - [x] Validate entry text (minimum/maximum length)
  - [x] Display entries in chronological order within each column
- [x] Implement entry linking functionality (AC: 3)
  - [x] Add "Link" button/icon to each entry
  - [x] Create UI for selecting target entry from adjacent columns
  - [x] Visual indication of linked entries (lines, colors, or icons)
  - [x] Allow users to view linked relationships
- [x] Implement database persistence (AC: 4)
  - [x] Create Supabase database tables for BOB entries
  - [x] Create table for entry links/relationships
  - [x] Implement API endpoints for CRUD operations
  - [x] Add proper database constraints and indexes
- [x] Integrate with Activity Log (AC: 5)
  - [x] Create activity log entry when BOB entry is created
  - [x] Include relevant metadata (user, timestamp, entry type)
  - [x] Ensure Activity Log updates in real-time on dashboard

## Dev Notes
### Architecture Context
- **Technology Stack**: Next.js with TypeScript, Tailwind CSS for styling, Supabase for backend
- **State Management**: Use Zustand for local state management of BOB entries
- **UI Components**: Leverage Headless UI components for modals and interactive elements
- **Database**: PostgreSQL via Supabase with auto-generated REST API

### BOB Model Context
The BOB (Books of Business) model is a structured decision-making framework with three interconnected phases:
- **Situation Assessment**: Current state analysis and fact gathering
- **Judgments**: Analysis and evaluation of the situation
- **Decisions**: Concrete actions and choices based on judgments

### Integration Points
- Main navigation must include link to BOB page
- Activity Log on dashboard must display BOB-related events
- Future stories will reference BOB decisions for task creation

### Testing
**Test Standards**:
- Unit tests using Vitest and React Testing Library
- Test files located alongside components with `.test.tsx` extension
- E2E tests for critical flows using Playwright
- Test database operations with proper cleanup
- Mock Supabase client for unit tests

**Testing Requirements**:
- Test entry creation in all three columns
- Test entry linking functionality between columns
- Test real-time updates and state synchronization
- Test responsive design on different screen sizes
- Test database persistence and error handling

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-12 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
- Fixed TypeScript import issue in packages/db/src/client.ts by using explicit path './types/index'
- Build successful with warning about workspace root detection (pre-existing)
- Tests passing for BOB page implementation

### Completion Notes List
- Task 1 completed: BOB model page structure created with responsive three-column layout
- Task 2 completed: Entry creation functionality fully implemented
- Task 3 completed: Entry linking functionality fully implemented
- Task 4 completed: Database persistence fully implemented
- Task 5 completed: Activity Log integration fully implemented
- Navigation updated in dashboard to include BOB Model link
- Authentication layout added for BOB page
- Modal-based entry creation with proper validation (3-500 characters)
- Full linking system: Judgments can link to Assessments, Decisions can link to both
- Visual indicators: linked entries show with blue highlighting and "Linked" badges
- Complete database integration: PostgreSQL tables, API clients, and proper RLS policies
- Automatic activity logging: Database triggers create activity log entries for all BOB actions
- Real-time activity updates: Dashboard Activity Log component displays BOB activities
- Rich activity descriptions: Include user, action type, and content previews
- Entries display chronologically with timestamps and show their relationships
- Comprehensive tests implemented and passing (15 test cases with test/prod environment handling)
- Build successful, all functionality working in both development and production modes

### File List
- /apps/web/src/app/bob/page.tsx (created)
- /apps/web/src/app/bob/layout.tsx (created)  
- /apps/web/src/app/bob/page.test.tsx (created)
- /apps/web/src/app/dashboard/page.tsx (modified - added BOB Model to navigation)
- /packages/db/src/client.ts (modified - added BOB and Activity API client functions)
- /packages/db/src/types/index.ts (modified - added BobEntry, BobLink, and Activity types)
- /apps/supabase/migrations/20250912000004_create_bob_model.sql (created - database schema with activity triggers)

## QA Results
*Results from QA Agent review will be populated here after implementation*