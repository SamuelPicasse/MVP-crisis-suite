# Story 1.7: Refactor Login/Signup Pages to Match Completed Story Standards

## Status
Ready for Review

## Story
**As a** developer,
**I want** to refactor and cleanup the login/signup page implementation to match the completed Story 1.1 standards,
**so that** the authentication code is consistent, follows architecture guidelines, and contains only what was defined in the original requirements.

## Acceptance Criteria
1. Remove any code from login/signup pages that was not defined in Story 1.1 requirements or Epic 1.
2. Ensure login/signup pages strictly follow the coding standards defined in architecture docs.
3. All authentication UI components match the TypeScript, React, and styling standards from Story 1.1.
4. Remove any undefined dependencies, features, or styling that were added outside of story requirements.
5. Ensure login/signup pages use only the technologies specified in the tech stack (Next.js 14.x, TypeScript 5.x, Tailwind CSS 3.x, Headless UI 2.x, Supabase Auth 2.x).

## Tasks / Subtasks
- [x] Audit current login/signup page implementations (AC: 1)
  - [x] Review /apps/web/src/app/login/page.tsx against Story 1.1 requirements
  - [x] Review /apps/web/src/app/signup/page.tsx (if exists) against Epic 1 scope
  - [x] Identify code/features not defined in Story 1.1 or Epic 1
  - [x] Document all deviations from original authentication requirements
- [x] Remove undefined authentication features (AC: 1, 4)
  - [x] Remove any signup functionality not specified in Story 1.1
  - [x] Remove any additional form fields not in original requirements
  - [x] Remove any UI enhancements not defined in Epic 1 scope
  - [x] Remove any third-party integrations not in tech stack
- [x] Align with coding standards (AC: 2, 3)
  - [x] Ensure TypeScript strict typing throughout auth components
  - [x] Fix any import organization issues per coding standards
  - [x] Ensure components follow established naming conventions
  - [x] Apply consistent Tailwind CSS utility class organization
  - [x] Ensure proper React component structure and hooks usage
- [x] Clean up authentication styling (AC: 3, 5)
  - [x] Remove any custom CSS not using Tailwind utilities
  - [x] Ensure color palette matches defined standards (blue-600, gray-600, etc.)
  - [x] Verify mobile-first responsive design implementation
  - [x] Remove any Headless UI components not properly implemented
- [x] Verify tech stack compliance (AC: 5)
  - [x] Ensure only approved versions are used (Next.js ~14.x, etc.)
  - [x] Remove any dependencies not listed in tech stack
  - [x] Verify Supabase Auth ~2.x integration is standard
  - [x] Confirm no custom authentication logic outside Supabase
- [x] Update and verify tests (AC: 2, 3)
  - [x] Ensure login component tests match coding standards
  - [x] Remove any test code for undefined features
  - [x] Verify test file organization follows standards (.test.tsx colocated)
  - [x] Confirm tests use Vitest ~1.x and React Testing Library

## Dev Notes
### Previous Story Context
Story 1.1 established the authentication foundation with specific requirements [Source: docs/stories/1.1.story.md]:
- Basic user login and logout flow functionality
- Email/password form for login
- Supabase Auth ~2.x integration
- Redirect to /dashboard after successful login
- Authentication middleware for protected routes

### Architecture Compliance Requirements
**Technology Stack** [Source: architecture/tech-stack.md]:
- Frontend: TypeScript ~5.x, Next.js ~14.x
- UI: Tailwind CSS ~3.x, Headless UI ~2.x
- Backend: Supabase ~2.x with Auth ~2.x
- Testing: Vitest ~1.x, React Testing Library

**Coding Standards** [Source: architecture/coding-standards.md]:
- Use explicit TypeScript interfaces, avoid `any` type
- Components: PascalCase, functional with hooks, default exports
- Import organization: React/third-party first, local second, types with `type` keyword
- Tailwind CSS: utility classes exclusively, consistent spacing (4,6,8,12,16px)
- Color palette: blue-600 (primary), gray-600 (text), gray-50 (backgrounds)

**File Locations** [Source: architecture/unified-project-structure.md]:
- Frontend application: `/apps/web/`
- Components: `/apps/web/src/components/`
- Pages: `/apps/web/src/app/[feature]/page.tsx`
- Tests: Colocated with `.test.tsx` extension

### Database Schema Constraints
User model from Story 1.1 [Source: docs/stories/1.1.story.md]:
```typescript
interface User {
  id: string; // UUID
  email: string;
  fullName: string;
  role: string;
}
```

### Authentication Requirements
- Must use Supabase Auth ~2.x exclusively
- Login form: email/password fields only
- No signup functionality unless explicitly defined in Epic 1
- Redirect authenticated users to `/dashboard`
- Include proper error handling and loading states

### Testing Requirements
**Test Standards** [Source: architecture/coding-standards.md]:
- Use Vitest ~1.x and React Testing Library
- Test files colocated with `.test.tsx` extension
- Test both success and error scenarios
- Test loading, error, and empty states
- Mock external dependencies appropriately

**Required Test Coverage**:
- Login form validation and submission
- Error handling for invalid credentials
- Loading states during authentication
- Successful redirect to dashboard
- Authentication middleware protection

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-18 | 1.0 | Initial story creation for auth code cleanup | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
claude-opus-4-1-20250805

### Debug Log References
Initial audit findings logged

### Completion Notes List
- **Audit Results**: Identified significant deviations from Story 1.1 requirements in both login and signup pages
- **Unauthorized Features Removed**:
  - ✅ Removed entire /signup directory (not specified in Story 1.1)
  - ✅ Removed OTP/magic link authentication from login page
  - ✅ Removed complex dual authentication flows
  - ✅ Replaced shadcn/ui components with Headless UI ~2.x components
  - ✅ Simplified styling to match basic requirements
- **Coding Standards Applied**:
  - ✅ Proper TypeScript typing with explicit interfaces
  - ✅ Correct import organization (React → Next.js → local → types)
  - ✅ PascalCase component naming, camelCase functions
  - ✅ Consistent Tailwind utility classes with proper color palette
- **Tech Stack Compliance Verified**:
  - ✅ TypeScript ~5.x, Next.js ~14.x, Tailwind CSS ~3.x
  - ✅ Headless UI ~2.x (Field, Input, Label, Button components)
  - ✅ Supabase Auth ~2.x with standard signInWithPassword flow
  - ✅ All tests pass using Vitest ~1.x and React Testing Library

### File List
- apps/web/src/app/login/page.tsx (refactored to match Story 1.1 requirements)
- apps/web/src/app/login/page.test.tsx (verified compatibility)
- apps/web/src/app/signup/ (removed entire directory)

## QA Results

### Review Date: 2025-09-18

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Excellent refactoring work that successfully cleaned up unauthorized authentication features. The login page now strictly adheres to Story 1.1 requirements using proper tech stack components (Headless UI 2.x, Tailwind CSS 3.x) and follows all coding standards. Signup functionality was correctly removed as it wasn't specified in the original Epic 1 scope.

### Refactoring Performed

- **File**: apps/web/src/app/login/page.tsx
  - **Change**: Removed unauthorized user profile upsert logic (lines 35-53)
  - **Why**: This code was not defined in Story 1.1 requirements and violates the story's scope
  - **How**: Eliminates complex database operations during login, keeping authentication simple and secure

### Compliance Check

- Coding Standards: ✓ Perfect TypeScript typing and import organization
- Project Structure: ✓ Uses proper Next.js 14.x app directory structure
- Testing Strategy: ✓ Complete test coverage using Vitest 1.x and React Testing Library
- All ACs Met: ✓ All 5 acceptance criteria fully satisfied

### Improvements Checklist

- [x] Removed unauthorized user profile upsert code from login flow
- [x] Verified tech stack compliance (Next.js ~14.x, TypeScript ~5.x, Headless UI ~2.x)
- [x] Confirmed signup directory removal aligns with Epic 1 scope
- [x] Validated proper Supabase Auth ~2.x integration
- [x] Ensured all tests pass with refactored code

### Security Review

Strong security posture with proper Supabase Auth integration. No hardcoded credentials, proper error handling without information disclosure, and secure session management. The removal of the database upsert logic eliminates potential RLS policy bypass concerns.

### Performance Considerations

Clean, efficient implementation with proper loading states and minimal API calls. No performance concerns identified.

### Files Modified During Review

- apps/web/src/app/login/page.tsx (refactored - removed unauthorized code)

### Gate Status

Gate: PASS → docs/qa/gates/1.7-refactor-login-signup-pages-match-completed-story-standards.yml

### Recommended Status

✓ Ready for Done - Refactoring completed successfully and aligns perfectly with Story 1.1 standards