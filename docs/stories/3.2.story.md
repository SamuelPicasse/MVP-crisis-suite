# <!-- Powered by BMAD™ Core -->

# Story 3.2: User Action & API Call Instrumentation

## Status
Draft

## Story
**As a** Crisis Management Team member using the system,
**I want** all my interactions (BOB entries, task creation, communications) and underlying API calls to be transparently logged for debugging,
**so that** when issues occur, developers can trace exactly what happened without any impact on my user experience.

## Acceptance Criteria

1. Instrument all user interactions in BOB model interface (create, update, link entries)
2. Add logging to task management operations (create, assign, status updates)
3. Instrument communication module actions (post announcements, view logs)
4. Log all database operations with timing and success/failure status
5. Track user authentication and session management events
6. Capture component state changes and error conditions
7. Ensure zero impact on existing user workflows and response times
8. Verify all existing functionality works exactly as before

## Tasks / Subtasks

- [ ] Instrument BOB Model interactions (AC: 1)
  - [ ] Add logging to BOB entry creation/editing
  - [ ] Log entry linking operations between columns
  - [ ] Track BOB model state changes and validations
  - [ ] Instrument any BOB-related API calls

- [ ] Add task management instrumentation (AC: 2)
  - [ ] Log task creation from decisions
  - [ ] Track task assignment operations
  - [ ] Monitor task status updates and transitions
  - [ ] Instrument task list viewing and filtering

- [ ] Instrument communication module (AC: 3)
  - [ ] Log communication post operations
  - [ ] Track communication log viewing
  - [ ] Monitor real-time updates and notifications
  - [ ] Instrument communication-related database calls

- [ ] Add comprehensive database operation logging (AC: 4, 5)
  - [ ] Enhance Supabase wrapper to log all RPC calls with timing
  - [ ] Track authentication state changes
  - [ ] Log session management events
  - [ ] Monitor database connection and error states

- [ ] Component-level instrumentation (AC: 6)
  - [ ] Add state change logging to ActivityLog component
  - [ ] Instrument CrisisSummary component interactions
  - [ ] Track ResponsibilityCardList and DocumentList component usage
  - [ ] Log component mount/unmount and lifecycle events

- [ ] Performance and regression testing (AC: 7, 8)
  - [ ] Verify no performance degradation in dashboard loading
  - [ ] Test all existing workflows remain unchanged
  - [ ] Run complete test suite to ensure no regressions
  - [ ] Performance benchmark critical user paths

## Dev Notes

**Existing System Components to Instrument:**
- ActivityLog component: `/apps/web/components/dashboard/ActivityLog.tsx`
- CrisisSummary component: `/apps/web/components/dashboard/CrisisSummary.tsx`
- ResponsibilityCardList: `/apps/web/components/reference/ResponsibilityCardList.tsx`
- DocumentList: `/apps/web/components/reference/DocumentList.tsx`
- Page components in `/apps/web/src/app/` directory

**Key API Endpoints to Monitor:**
- `get_activity_log` RPC call (already exists in ActivityLog)
- BOB model CRUD operations (to be implemented)
- Task management operations (to be implemented)
- Communication posting and retrieval (to be implemented)

**User Journey Critical Paths:**
- Login → Dashboard view (5-second responsibility identification goal)
- Dashboard → BOB model → Create entries → Link entries
- BOB model → Create task from decision
- Communication posting and viewing
- Document and responsibility card access

**Integration with Story OBS.1:**
- Use centralized LogService created in previous story
- Leverage correlation ID system for request tracking
- Utilize structured logging format and async batching

### Testing
**Testing Standards:**
- Component test files: `apps/web/components/**/*.test.tsx`
- Page test files: `apps/web/src/app/**/*.test.tsx`
- Use Vitest framework with React Testing Library
- Mock all Supabase calls and verify logging calls
- Integration tests for complete user workflows
- Performance tests to verify <3 second dashboard load time
- Test logging in both enabled/disabled states

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-12 | 1.0 | Initial story creation | Sarah, PO |

## Dev Agent Record
*This section will be populated during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*To be filled by QA agent*